<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasAdminMenu" aria-labelledby="offcanvasAdminMenuLabel"
    style="
        background: rgba(18, 18, 18, 0.95) !important;
        backdrop-filter: blur(15px);
        border: 2px solid #e2b275 !important;
        color: #e2b275;
        width: 350px;

        top: 85px !important;
        right: 20px !important;
        height: auto !important;
        max-height: 85vh !important;

        border-radius: 20px !important;
        box-shadow: 0 10px 40px rgba(0,0,0,0.8) !important;

        bottom: auto !important;
        transition: transform 0.3s ease-in-out;
    ">

    <div class="offcanvas-header" style="border-bottom: 1px solid rgba(226, 178, 117, 0.3); padding: 1rem 1.5rem;">
        <h4 class="offcanvas-title fw-bold" id="offcanvasAdminMenuLabel" style="color: #e2b275; font-size: 1.2rem;">Rendszermenü</h4>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close" style="filter: invert(1) sepia(1) saturate(5);"></button>
    </div>

    <div class="offcanvas-body" style="padding: 1.5rem;">
        <div class="mb-3">
            <h6 class="fw-bold small border-bottom pb-2" style="color: #ffffff; opacity: 0.7;">Funkciók</h6>
        </div>
        {% if session.get('user_permissions') and session['user_permissions'].get('func_UserHandling') %}
        <div class="dropdown mb-2">
            <button class="btn btn-admin-dropdown dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown">
                <i class="bi bi-people-fill me-2"></i> Felhasználók
            </button>
            <ul class="dropdown-menu dropdown-menu-dark w-100 shadow" style="border: 1px solid #e2b275; background: #222;">
                <li><a class="dropdown-item" href="#"><i class="bi bi-people"></i> Felhasználók kezelése</a></li>
                <li>
                    <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modalPermissions">
                        <i class="bi bi-card-checklist me-2"></i> Jogosultságok kezelése
                    </a>
                </li>
            </ul>
        </div>
        {% endif %}
        {% if session.get('user_permissions') and session['user_permissions'].get('func_QueryCreator') %}
        <div class="dropdown mb-2">
            <button class="btn btn-admin-dropdown dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown">
                <i class="bi bi-list-task"></i> Listák / Legyűjtések
            </button>
            <ul class="dropdown-menu dropdown-menu-dark w-100 shadow" style="border: 1px solid #e2b275; background: #222;">
                <li><a class="dropdown-item" href="#"><i class="bi bi-list-ol"></i> Lejáró SzBT-k (60 nap)</a></li>
                <li><a class="dropdown-item text-warning" href="#"><i class="bi bi-list"></i> NATO/EU SzBT lista </a></li>
                <li><a class="dropdown-item text-warning" href="#"><i class="bi bi-list"></i> stb... </a></li>
            </ul>
        </div>
        {% endif %}
        <hr style="border-color: rgba(226, 178, 117, 0.3); margin: 1rem 0;">
        <ul class="list-unstyled mb-0">
            {% if session.get('user_permissions') and session['user_permissions'].get('func_AppSettings') %}
            <li class="mb-2"><a href="#" class="nav-link admin-link"><i class="bi bi-gear-fill"></i> {{ config['APP_SHORTNAME'] }} beállításai</a></li>
            {% endif %}
            {% if session.get('user_permissions') and session['user_permissions'].get('func_Logging') %}
            <li class="mb-2"><a href="#" class="nav-link admin-link"><i class="bi bi-activity"></i> Loggolási bejegyzések</a></li>
            {% endif %}
            <li>
                <a href="#" class="nav-link admin-link border-top pb-2" data-bs-toggle="modal" data-bs-target="#aboutModal">
                    <i class="bi bi-info-circle me-2"></i> Névjegy
                </a>
            </li>
        </ul>
    </div>
</div>

<div class="modal fade" id="modalPermissions" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content" style="
            background: rgba(18, 18, 18, 0.98);
            backdrop-filter: blur(20px);
            border: 2px solid #e2b275;
            border-radius: 25px;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
            color: #ffffff;">

            <div class="modal-header" style="border-bottom: 1px solid rgba(226, 178, 117, 0.3); padding: 1.5rem 2rem;">
                <h3 class="modal-title fw-bold" style="color: #e2b275;">
                    <i class="bi bi-shield-lock-fill me-3"></i>Jogosultsági Mátrix
                </h3>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1) sepia(1) saturate(5);"></button>
            </div>

            <div class="modal-body" style="padding: 2rem; max-height: 70vh; overflow-y: auto;">
                <p class="text-muted mb-4 small">lnek.</p>
                <div class="table-responsive">
                    <table class="table table-dark table-hover align-middle custom-perm-table">
                        <thead class="sticky-top" style="background: #121212; z-index: 10;">
                            <tr style="color: #e2b275; border-bottom: 2px solid #e2b275;">
                                <th>Ügynök / Azonosító</th>
                                <th class="text-center">Személyi (Persec)</th>
                                <th class="text-center">Rendszerek (Systems)</th>
                                <th class="text-center">Felvétel (Hiring)</th>
                                <th class="text-center text-muted small">Módosítva</th>
                            </tr>
                        </thead>
                        <tbody id="permissionsTableBody">

                        </tbody>
                    </table>
                </div>
            </div>

            <div class="modal-footer" style="border-top: 1px solid rgba(226, 178, 117, 0.2); padding: 1rem 2rem;">
                <button type="button" class="btn btn-outline-gold" data-bs-dismiss="modal">Bezárás</button>
            </div>
        </div>
    </div>
</div>

<style>
/* Egyedi Arany Kapcsoló Stílus */
.custom-switch:checked {
    background-color: #e2b275 !important;
    border-color: #e2b275 !important;
}
.custom-switch {
    cursor: pointer;
    background-color: rgba(255,255,255,0.1);
    border-color: rgba(226, 178, 117, 0.5);
}
.btn-outline-gold {
    border: 1px solid #e2b275;
    color: #e2b275;
    border-radius: 10px;
    padding: 8px 25px;
    transition: all 0.3s;
}
.btn-outline-gold:hover {
    background: #e2b275;
    color: #000;
}
.custom-perm-table td {
    padding: 1rem;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

/* Egyedi stílusok az Admin Offcanvas-hoz */
.admin-link {
    color: #ffffff !important;
    padding: 10px 15px;
    border-radius: 8px;
    transition: all 0.3s;
    display: block;
    text-decoration: none;
}

.admin-link:hover {
    background: rgba(226, 178, 117, 0.15);
    color: #e2b275 !important;
    padding-left: 20px;
}

.btn-admin-dropdown {
    background: rgba(255, 255, 255, 0.05) !important;
    border: 1px solid rgba(226, 178, 117, 0.3) !important;
    color: #ffffff !important;
    padding: 10px 15px;
    transition: all 0.3s;
}

.btn-admin-dropdown:hover, .btn-admin-dropdown:focus {
    border-color: #e2b275 !important;
    background: rgba(226, 178, 117, 0.1) !important;
    color: #e2b275 !important;
}

.dropdown-item {
    color: #ffffff !important;
    padding: 10px 20px;
}

.dropdown-item:hover {
    background-color: #e2b275 !important;
    color: #000000 !important;
}
</style>